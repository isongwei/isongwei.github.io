<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iSong" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="先拆轮子,在造轮子!">
<meta property="og:type" content="website">
<meta property="og:title" content="Song">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Song">
<meta property="og:description" content="先拆轮子,在造轮子!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Song">
<meta name="twitter:description" content="先拆轮子,在造轮子!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Song</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Song</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/02/AFNetworking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/02/AFNetworking/" itemprop="url">AFNetworking</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-02T10:57:23+08:00">
                2017-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="AFNetworkReachabilityManager"><a href="#AFNetworkReachabilityManager" class="headerlink" title="AFNetworkReachabilityManager"></a>AFNetworkReachabilityManager</h2><p>###开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">#if !TARGET_OS_WATCH</div><div class="line">#import &lt;SystemConfiguration/SystemConfiguration.h&gt;</div><div class="line"></div><div class="line">typedef NS_ENUM(NSInteger, AFNetworkReachabilityStatus) &#123;</div><div class="line">    AFNetworkReachabilityStatusUnknown          = -1,</div><div class="line">    AFNetworkReachabilityStatusNotReachable     = 0,</div><div class="line">    AFNetworkReachabilityStatusReachableViaWWAN = 1,</div><div class="line">    AFNetworkReachabilityStatusReachableViaWiFi = 2,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">NS_ASSUME_NONNULL_BEGIN</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"></div><div class="line"> See Apple&apos;s Reachability Sample Code ( https://developer.apple.com/library/ios/samplecode/reachability/ )</div><div class="line"> 警告使用之前必须</div><div class="line"> @warning Instances of `AFNetworkReachabilityManager` must be started with `-startMonitoring` before reachability status can be determined.</div><div class="line"> */</div><div class="line">@interface AFNetworkReachabilityManager : NSObject</div><div class="line"></div><div class="line">/**</div><div class="line"> 当前网络状态</div><div class="line"> */</div><div class="line">@property (readonly, nonatomic, assign) AFNetworkReachabilityStatus networkReachabilityStatus;</div><div class="line"></div><div class="line">/**</div><div class="line"> 当前网络状态是否可用</div><div class="line"> */</div><div class="line">@property (readonly, nonatomic, assign, getter = isReachable) BOOL reachable;</div><div class="line"></div><div class="line">/**</div><div class="line"> 判断当前网络状态</div><div class="line"> */</div><div class="line">@property (readonly, nonatomic, assign, getter = isReachableViaWWAN) BOOL reachableViaWWAN;</div><div class="line">@property (readonly, nonatomic, assign, getter = isReachableViaWiFi) BOOL reachableViaWiFi;</div><div class="line"></div><div class="line">///---------------------</div><div class="line">/// @name Initialization</div><div class="line">///---------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> 单例对象</div><div class="line"> */</div><div class="line">+ (instancetype)sharedManager;</div><div class="line"></div><div class="line">/**</div><div class="line">创建并返回 the default socket address.</div><div class="line"> */</div><div class="line">+ (instancetype)manager;</div><div class="line"></div><div class="line">/**</div><div class="line"> 为特殊域名创建并返回</div><div class="line"> */</div><div class="line">+ (instancetype)managerForDomain:(NSString *)domain;</div><div class="line"></div><div class="line">/**</div><div class="line"> 创建并返回for the socket address.</div><div class="line"> */</div><div class="line">+ (instancetype)managerForAddress:(const void *)address;</div><div class="line"></div><div class="line">/**</div><div class="line"> 初始化实例(用来保存创建测试连接返回的引用)</div><div class="line"> */</div><div class="line">- (instancetype)initWithReachability:(SCNetworkReachabilityRef)reachability NS_DESIGNATED_INITIALIZER;</div><div class="line"></div><div class="line">///--------------------------------------------------</div><div class="line">/// @name Starting &amp; Stopping Reachability Monitoring</div><div class="line">///--------------------------------------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> 开始监控</div><div class="line"> */</div><div class="line">- (void)startMonitoring;</div><div class="line">/**</div><div class="line"> 停止监控</div><div class="line"> */</div><div class="line">- (void)stopMonitoring;</div><div class="line"></div><div class="line">///-------------------------------------------------</div><div class="line">/// @name Getting Localized Reachability Description</div><div class="line">///-------------------------------------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> 返回本地化的状态</div><div class="line"> */</div><div class="line">- (NSString *)localizedNetworkReachabilityStatusString;</div><div class="line"></div><div class="line">///---------------------------------------------------</div><div class="line">/// @name Setting Network Reachability Change Callback</div><div class="line">///---------------------------------------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> 当`baseURL` host changes就会执行</div><div class="line"> */</div><div class="line">- (void)setReachabilityStatusChangeBlock:(nullable void (^)(AFNetworkReachabilityStatus status))block;</div><div class="line"></div><div class="line">@end</div><div class="line">/*</div><div class="line">网络状态改变时所发的通知</div><div class="line"> @warning In order for network reachability to be monitored, include the `SystemConfiguration` framework in the active target&apos;s &quot;Link Binary With Library&quot; build phase, and add `#import &lt;SystemConfiguration/SystemConfiguration.h&gt;` to the header prefix of the project (`Prefix.pch`).</div><div class="line"> */</div><div class="line">FOUNDATION_EXPORT NSString * const AFNetworkingReachabilityDidChangeNotification;</div><div class="line">FOUNDATION_EXPORT NSString * const AFNetworkingReachabilityNotificationStatusItem;</div><div class="line"></div><div class="line">///--------------------</div><div class="line">/// @name Functions</div><div class="line">///--------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> Returns a localized string representation of an `AFNetworkReachabilityStatus` value.</div><div class="line"> */</div><div class="line">FOUNDATION_EXPORT NSString * AFStringFromNetworkReachabilityStatus(AFNetworkReachabilityStatus status);</div><div class="line"></div><div class="line">NS_ASSUME_NONNULL_END</div><div class="line">#endif</div></pre></td></tr></table></figure>
<h4 id="实现文件"><a href="#实现文件" class="headerlink" title="实现文件"></a>实现文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#import &quot;AFNetworkReachabilityManager.h&quot;</div><div class="line">#if !TARGET_OS_WATCH</div><div class="line"></div><div class="line">#import &lt;netinet/in.h&gt;</div><div class="line">#import &lt;netinet6/in6.h&gt;</div><div class="line">#import &lt;arpa/inet.h&gt;</div><div class="line">#import &lt;ifaddrs.h&gt;</div><div class="line">#import &lt;netdb.h&gt;</div><div class="line"></div><div class="line">NSString * const AFNetworkingReachabilityDidChangeNotification = @&quot;com.alamofire.networking.reachability.change&quot;;</div><div class="line">NSString * const AFNetworkingReachabilityNotificationStatusItem = @&quot;AFNetworkingReachabilityNotificationStatusItem&quot;;</div><div class="line"></div><div class="line">typedef void (^AFNetworkReachabilityStatusBlock)(AFNetworkReachabilityStatus status);</div><div class="line"></div><div class="line">NSString * AFStringFromNetworkReachabilityStatus(AFNetworkReachabilityStatus status) &#123;</div><div class="line">    switch (status) &#123;</div><div class="line">        case AFNetworkReachabilityStatusNotReachable:</div><div class="line">            return NSLocalizedStringFromTable(@&quot;Not Reachable&quot;, @&quot;AFNetworking&quot;, nil);</div><div class="line">        case AFNetworkReachabilityStatusReachableViaWWAN:</div><div class="line">            return NSLocalizedStringFromTable(@&quot;Reachable via WWAN&quot;, @&quot;AFNetworking&quot;, nil);</div><div class="line">        case AFNetworkReachabilityStatusReachableViaWiFi:</div><div class="line">            return NSLocalizedStringFromTable(@&quot;Reachable via WiFi&quot;, @&quot;AFNetworking&quot;, nil);</div><div class="line">        case AFNetworkReachabilityStatusUnknown:</div><div class="line">        default:</div><div class="line">            return NSLocalizedStringFromTable(@&quot;Unknown&quot;, @&quot;AFNetworking&quot;, nil);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">static AFNetworkReachabilityStatus AFNetworkReachabilityStatusForFlags(SCNetworkReachabilityFlags flags) &#123;</div><div class="line">    BOOL isReachable = ((flags &amp; kSCNetworkReachabilityFlagsReachable) != 0);</div><div class="line">    BOOL needsConnection = ((flags &amp; kSCNetworkReachabilityFlagsConnectionRequired) != 0);</div><div class="line">    BOOL canConnectionAutomatically = (((flags &amp; kSCNetworkReachabilityFlagsConnectionOnDemand ) != 0) || ((flags &amp; kSCNetworkReachabilityFlagsConnectionOnTraffic) != 0));</div><div class="line">    BOOL canConnectWithoutUserInteraction = (canConnectionAutomatically &amp;&amp; (flags &amp; kSCNetworkReachabilityFlagsInterventionRequired) == 0);</div><div class="line">    BOOL isNetworkReachable = (isReachable &amp;&amp; (!needsConnection || canConnectWithoutUserInteraction));</div><div class="line"></div><div class="line">    AFNetworkReachabilityStatus status = AFNetworkReachabilityStatusUnknown;</div><div class="line">    if (isNetworkReachable == NO) &#123;</div><div class="line">        status = AFNetworkReachabilityStatusNotReachable;</div><div class="line">    &#125;</div><div class="line">#if	TARGET_OS_IPHONE</div><div class="line">    else if ((flags &amp; kSCNetworkReachabilityFlagsIsWWAN) != 0) &#123;</div><div class="line">        status = AFNetworkReachabilityStatusReachableViaWWAN;</div><div class="line">    &#125;</div><div class="line">#endif</div><div class="line">    else &#123;</div><div class="line">        status = AFNetworkReachabilityStatusReachableViaWiFi;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return status;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Queue a status change notification for the main thread.</div><div class="line"> *</div><div class="line"> * This is done to ensure that the notifications are received in the same order</div><div class="line"> * as they are sent. If notifications are sent directly, it is possible that</div><div class="line"> * a queued notification (for an earlier status condition) is processed after</div><div class="line"> * the later update, resulting in the listener being left in the wrong state.</div><div class="line"> */</div><div class="line">static void AFPostReachabilityStatusChange(SCNetworkReachabilityFlags flags, AFNetworkReachabilityStatusBlock block) &#123;</div><div class="line">    AFNetworkReachabilityStatus status = AFNetworkReachabilityStatusForFlags(flags);</div><div class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">        if (block) &#123;</div><div class="line">            block(status);</div><div class="line">        &#125;</div><div class="line">        NSNotificationCenter *notificationCenter = [NSNotificationCenter defaultCenter];</div><div class="line">        NSDictionary *userInfo = @&#123; AFNetworkingReachabilityNotificationStatusItem: @(status) &#125;;</div><div class="line">        [notificationCenter postNotificationName:AFNetworkingReachabilityDidChangeNotification object:nil userInfo:userInfo];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">static void AFNetworkReachabilityCallback(SCNetworkReachabilityRef __unused target, SCNetworkReachabilityFlags flags, void *info) &#123;</div><div class="line">    AFPostReachabilityStatusChange(flags, (__bridge AFNetworkReachabilityStatusBlock)info);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">static const void * AFNetworkReachabilityRetainCallback(const void *info) &#123;</div><div class="line">    return Block_copy(info);</div><div class="line">&#125;</div><div class="line"></div><div class="line">static void AFNetworkReachabilityReleaseCallback(const void *info) &#123;</div><div class="line">    if (info) &#123;</div><div class="line">        Block_release(info);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@interface AFNetworkReachabilityManager ()</div><div class="line">//用来保存创建测试连接返回的引用</div><div class="line">@property (readonly, nonatomic, assign) SCNetworkReachabilityRef networkReachability;</div><div class="line">//状态</div><div class="line">@property (readwrite, nonatomic, assign) AFNetworkReachabilityStatus networkReachabilityStatus;</div><div class="line">执行回调</div><div class="line">@property (readwrite, nonatomic, copy) AFNetworkReachabilityStatusBlock networkReachabilityStatusBlock;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation AFNetworkReachabilityManager</div><div class="line">//创建单例对象</div><div class="line">+ (instancetype)sharedManager &#123;</div><div class="line">    static AFNetworkReachabilityManager *_sharedManager = nil;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        _sharedManager = [self manager];</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    return _sharedManager;</div><div class="line">&#125;</div><div class="line">//特定域名的对象(默认未知网络)</div><div class="line">+ (instancetype)managerForDomain:(NSString *)domain &#123;</div><div class="line">    SCNetworkReachabilityRef reachability = SCNetworkReachabilityCreateWithName(kCFAllocatorDefault, [domain UTF8String]);</div><div class="line"></div><div class="line">    AFNetworkReachabilityManager *manager = [[self alloc] initWithReachability:reachability];</div><div class="line">    </div><div class="line">    CFRelease(reachability);</div><div class="line"></div><div class="line">    return manager;</div><div class="line">&#125;</div><div class="line">//特定ipv4/ipv6的对象(默认未知网络)</div><div class="line">+ (instancetype)managerForAddress:(const void *)address &#123;</div><div class="line">    SCNetworkReachabilityRef reachability = SCNetworkReachabilityCreateWithAddress(kCFAllocatorDefault, (const struct sockaddr *)address);</div><div class="line">    AFNetworkReachabilityManager *manager = [[self alloc] initWithReachability:reachability];</div><div class="line"></div><div class="line">    CFRelease(reachability);</div><div class="line">    </div><div class="line">    return manager;</div><div class="line">&#125;</div><div class="line">//单例创建的配置</div><div class="line">+ (instancetype)manager</div><div class="line">&#123;</div><div class="line">#if (defined(__IPHONE_OS_VERSION_MIN_REQUIRED) &amp;&amp; __IPHONE_OS_VERSION_MIN_REQUIRED &gt;= 90000) || (defined(__MAC_OS_X_VERSION_MIN_REQUIRED) &amp;&amp; __MAC_OS_X_VERSION_MIN_REQUIRED &gt;= 101100)</div><div class="line">    struct sockaddr_in6 address;</div><div class="line">    bzero(&amp;address, sizeof(address));</div><div class="line">    address.sin6_len = sizeof(address);</div><div class="line">    address.sin6_family = AF_INET6;</div><div class="line">#else</div><div class="line">    struct sockaddr_in address;</div><div class="line">    bzero(&amp;address, sizeof(address));</div><div class="line">    address.sin_len = sizeof(address);</div><div class="line">    address.sin_family = AF_INET;</div><div class="line">#endif</div><div class="line">    return [self managerForAddress:&amp;address];</div><div class="line">&#125;</div><div class="line">//根据系统配置的创建</div><div class="line">- (instancetype)initWithReachability:(SCNetworkReachabilityRef)reachability &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (!self) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    _networkReachability = CFRetain(reachability);</div><div class="line">    self.networkReachabilityStatus = AFNetworkReachabilityStatusUnknown;</div><div class="line"></div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (instancetype)init NS_UNAVAILABLE</div><div class="line">&#123;</div><div class="line">    return nil;</div><div class="line">&#125;</div><div class="line">//销毁</div><div class="line">- (void)dealloc &#123;</div><div class="line">    [self stopMonitoring];</div><div class="line">    </div><div class="line">    if (_networkReachability != NULL) &#123;</div><div class="line">        CFRelease(_networkReachability);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 返回状态</div><div class="line"></div><div class="line">- (BOOL)isReachable &#123;</div><div class="line">    return [self isReachableViaWWAN] || [self isReachableViaWiFi];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isReachableViaWWAN &#123;</div><div class="line">    return self.networkReachabilityStatus == AFNetworkReachabilityStatusReachableViaWWAN;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isReachableViaWiFi &#123;</div><div class="line">    return self.networkReachabilityStatus == AFNetworkReachabilityStatusReachableViaWiFi;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 开始监控</div><div class="line"></div><div class="line">- (void)startMonitoring &#123;</div><div class="line">    [self stopMonitoring];</div><div class="line"></div><div class="line">    if (!self.networkReachability) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    __weak __typeof(self)weakSelf = self;</div><div class="line">    AFNetworkReachabilityStatusBlock callback = ^(AFNetworkReachabilityStatus status) &#123;</div><div class="line">        __strong __typeof(weakSelf)strongSelf = weakSelf;</div><div class="line"></div><div class="line">        strongSelf.networkReachabilityStatus = status;</div><div class="line">        if (strongSelf.networkReachabilityStatusBlock) &#123;</div><div class="line">            strongSelf.networkReachabilityStatusBlock(status);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SCNetworkReachabilityContext context = &#123;0, (__bridge void *)callback, AFNetworkReachabilityRetainCallback, AFNetworkReachabilityReleaseCallback, NULL&#125;;</div><div class="line">    SCNetworkReachabilitySetCallback(self.networkReachability, AFNetworkReachabilityCallback, &amp;context);</div><div class="line">    SCNetworkReachabilityScheduleWithRunLoop(self.networkReachability, CFRunLoopGetMain(), kCFRunLoopCommonModes);</div><div class="line"></div><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0),^&#123;</div><div class="line">        SCNetworkReachabilityFlags flags;</div><div class="line">        if (SCNetworkReachabilityGetFlags(self.networkReachability, &amp;flags)) &#123;</div><div class="line">            AFPostReachabilityStatusChange(flags, callback);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">#pragma mark - 停止监控</div><div class="line">- (void)stopMonitoring &#123;</div><div class="line">    if (!self.networkReachability) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    SCNetworkReachabilityUnscheduleFromRunLoop(self.networkReachability, CFRunLoopGetMain(), kCFRunLoopCommonModes);</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 返回国际化的状态</div><div class="line"></div><div class="line">- (NSString *)localizedNetworkReachabilityStatusString &#123;</div><div class="line">    return AFStringFromNetworkReachabilityStatus(self.networkReachabilityStatus);</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 变化的回调执行</div><div class="line"></div><div class="line">- (void)setReachabilityStatusChangeBlock:(void (^)(AFNetworkReachabilityStatus status))block &#123;</div><div class="line">    self.networkReachabilityStatusBlock = block;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - NSKeyValueObserving</div><div class="line"></div><div class="line">+ (NSSet *)keyPathsForValuesAffectingValueForKey:(NSString *)key &#123;</div><div class="line">    if ([key isEqualToString:@&quot;reachable&quot;] || [key isEqualToString:@&quot;reachableViaWWAN&quot;] || [key isEqualToString:@&quot;reachableViaWiFi&quot;]) &#123;</div><div class="line">        return [NSSet setWithObject:@&quot;networkReachabilityStatus&quot;];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return [super keyPathsForValuesAffectingValueForKey:key];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>###安全</p>
<h2 id="AFSecurityPolicy"><a href="#AFSecurityPolicy" class="headerlink" title="AFSecurityPolicy"></a>AFSecurityPolicy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">#import &lt;Security/Security.h&gt;</div><div class="line"></div><div class="line">//验证模式</div><div class="line">typedef NS_ENUM(NSUInteger, AFSSLPinningMode) &#123;</div><div class="line">    AFSSLPinningModeNone,</div><div class="line">    AFSSLPinningModePublicKey,</div><div class="line">    AFSSLPinningModeCertificate,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">/**</div><div class="line"> `AFSecurityPolicy` evaluates server trust against pinned X.509 certificates and public keys over secure connections.</div><div class="line"></div><div class="line"> Adding pinned SSL certificates to your app helps prevent man-in-the-middle attacks and other vulnerabilities. Applications dealing with sensitive customer data or financial information are strongly encouraged to route all communication over an HTTPS connection with SSL pinning configured and enabled.</div><div class="line"> */</div><div class="line"></div><div class="line">NS_ASSUME_NONNULL_BEGIN</div><div class="line"></div><div class="line">@interface AFSecurityPolicy : NSObject &lt;NSSecureCoding, NSCopying&gt;</div><div class="line"></div><div class="line">/**</div><div class="line">//验证模式</div><div class="line"> The criteria by which server trust should be evaluated against the pinned SSL certificates. Defaults to `AFSSLPinningModeNone`.</div><div class="line"> */</div><div class="line">@property (readonly, nonatomic, assign) AFSSLPinningMode SSLPinningMode;</div><div class="line"></div><div class="line">/**</div><div class="line"> The certificates used to evaluate server trust according to the SSL pinning mode. </div><div class="line"></div><div class="line">  By default, this property is set to any (`.cer`) certificates included in the target compiling AFNetworking. Note that if you are using AFNetworking as embedded framework, no certificates will be pinned by default. Use `certificatesInBundle` to load certificates from your target, and then create a new policy by calling `policyWithPinningMode:withPinnedCertificates`.</div><div class="line"> </div><div class="line"> Note that if pinning is enabled, `evaluateServerTrust:forDomain:` will return true if any pinned certificate matches.</div><div class="line"> */</div><div class="line">@property (nonatomic, strong, nullable) NSSet &lt;NSData *&gt; *pinnedCertificates;</div><div class="line"></div><div class="line">/**</div><div class="line">是否全部允许</div><div class="line"> Whether or not to trust servers with an invalid or expired SSL certificates. Defaults to `NO`.</div><div class="line"> */</div><div class="line">@property (nonatomic, assign) BOOL allowInvalidCertificates;</div><div class="line"></div><div class="line">/**</div><div class="line"> Whether or not to validate the domain name in the certificate&apos;s CN field. Defaults to `YES`.</div><div class="line"> */</div><div class="line">@property (nonatomic, assign) BOOL validatesDomainName;</div><div class="line"></div><div class="line">///-----------------------------------------</div><div class="line">/// @name Getting Certificates from the Bundle</div><div class="line">///-----------------------------------------</div><div class="line"></div><div class="line">/**</div><div class="line"></div><div class="line">    </div><div class="line">返回目录下的data数据</div><div class="line"> Returns any certificates included in the bundle. If you are using AFNetworking as an embedded framework, you must use this method to find the certificates you have included in your app bundle, and use them when creating your security policy by calling `policyWithPinningMode:withPinnedCertificates`.</div><div class="line"></div><div class="line"> @return The certificates included in the given bundle.</div><div class="line"> */</div><div class="line">+ (NSSet &lt;NSData *&gt; *)certificatesInBundle:(NSBundle *)bundle;</div><div class="line"></div><div class="line">///-----------------------------------------</div><div class="line">/// @name Getting Specific Security Policies</div><div class="line">///-----------------------------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> Returns the shared default security policy, which does not allow invalid certificates, validates domain name, and does not validate against pinned certificates or public keys.</div><div class="line"></div><div class="line"> @return The default security policy.</div><div class="line"> */</div><div class="line">+ (instancetype)defaultPolicy;</div><div class="line">///---------------------</div><div class="line">/// @name Initialization</div><div class="line">///---------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> Creates and returns a security policy with the specified pinning mode.</div><div class="line"></div><div class="line"> @param pinningMode The SSL pinning mode.</div><div class="line"> @return A new security policy.</div><div class="line"> */</div><div class="line">+ (instancetype)policyWithPinningMode:(AFSSLPinningMode)pinningMode;</div><div class="line"></div><div class="line">/**</div><div class="line"> Creates and returns a security policy with the specified pinning mode.</div><div class="line"></div><div class="line"> @param pinningMode The SSL pinning mode.</div><div class="line"> @param pinnedCertificates The certificates to pin against.</div><div class="line"> @return A new security policy.</div><div class="line"> */</div><div class="line">+ (instancetype)policyWithPinningMode:(AFSSLPinningMode)pinningMode withPinnedCertificates:(NSSet &lt;NSData *&gt; *)pinnedCertificates;</div><div class="line"></div><div class="line">///------------------------------</div><div class="line">/// @name Evaluating Server Trust</div><div class="line">///------------------------------</div><div class="line"></div><div class="line">/**</div><div class="line"> Whether or not the specified server trust should be accepted, based on the security policy.</div><div class="line"></div><div class="line"> This method should be used when responding to an authentication challenge from a server.</div><div class="line"></div><div class="line"> @param serverTrust The X.509 certificate trust of the server.</div><div class="line"> @param domain The domain of serverTrust. If `nil`, the domain will not be validated.</div><div class="line"></div><div class="line"> @return Whether or not to trust the server.</div><div class="line"> */</div><div class="line">- (BOOL)evaluateServerTrust:(SecTrustRef)serverTrust</div><div class="line">                  forDomain:(nullable NSString *)domain;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">NS_ASSUME_NONNULL_END</div></pre></td></tr></table></figure>
<h5 id="最主要的"><a href="#最主要的" class="headerlink" title="最主要的"></a>最主要的</h5><p>AFURLSessionManager : NSObject <nsurlsessiondelegate, nsurlsessiontaskdelegate,="" nsurlsessiondatadelegate,="" nsurlsessiondownloaddelegate,="" nssecurecoding,="" nscopying=""></nsurlsessiondelegate,></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/06/LLDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/06/LLDB/" itemprop="url">LLDB 的调试使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-06T10:24:53+08:00">
                2017-04-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自<br><a href="https://objccn.io/issue-19-2/" target="_blank" rel="external">与调试器共舞 - LLDB 的华尔兹</a></p>
<h3 id="LLDB"><a href="#LLDB" class="headerlink" title="LLDB"></a>LLDB</h3><blockquote>
<p>LLDB 是一个有着 REPL 的特性和 C++ ,Python 插件的开源调试器。LLDB 绑定在 Xcode 内部，存在于主窗口底部的控制台中。调试器允许你在程序运行的特定时暂停它，你可以查看变量的值，执行自定的指令，并且按照你所认为合适的步骤来操作程序的进展。(这里有一个关于调试器如何工作的总体的解释。)</p>
<p>你以前有可能已经使用过调试器，即使只是在 Xcode 的界面上加一些断点。但是通过一些小的技巧，你就可以做一些非常酷的事情。GDB to LLDB 参考是一个非常好的调试器可用命令的总览。你也可以安装 Chisel，它是一个开源的 LLDB 插件合辑，这会使调试变得更加有趣。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/13/@synchronized的简单实用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/13/@synchronized的简单实用/" itemprop="url">synchronized的简单实用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T14:52:12+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>@synchronized</code> 结构所做的事情跟锁<code>lock</code>类似：它防止不同的线程同时执行同一段代码。但在某些情况下，相比于使用 <code>NSLock</code>创建锁对象、加锁和解锁来说，<code>@synchronized</code>用着更方便，可读性更高。</p>
<p><code>@synchronized</code> 的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@implementation ThreadSafeQueue</div><div class="line">&#123;</div><div class="line">    NSMutableArray *_elements;</div><div class="line">    NSLock *_lock;</div><div class="line">&#125;</div><div class="line">- (instancetype)init</div><div class="line">&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        _elements = [NSMutableArray array];</div><div class="line">        _lock = [[NSLock alloc] init];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">- (void)push:(id)element</div><div class="line">&#123;</div><div class="line">    [_lock lock];</div><div class="line">    [_elements addObject:element];</div><div class="line">    [_lock unlock];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>i<br>上面的 <code>ThreadSafeQueue</code>类有个<code>init</code>方法，它初始化了一个 <code>_elements</code>数组和一个 <code>NSLock</code>实例。<br>这个类还有个 <code>push:</code>方法，它先获取锁、然后向数组中插入元素、最终释放锁。可能会有许多线程同时调用 <code>push:</code>方法，但是<code>[_elements addObject:element]</code>这行代码在任何时候将只会在一个线程上运行。步骤如下：<br>1 线程 A 调用 <code>push:</code>方法<br>2 线程 B 调用 <code>push:</code>方法<br>3 线程 B 调用 <code>[_lock lock]</code>- 因为当前没有其他线程持有锁，线程 B 获得了锁<br>4 线程 A 调用 <code>[_lock lock]</code>，但是锁已经被线程 B 占了所以方法调用并没有返回-这会暂停线程 A 的执行<br>5 线程 B 向 <code>_elements</code>添加元素后调用 <code>[_lock unlock]</code>。当这些发生时，线程 A 的<code>[_lock lock]</code>方法返回，并继续将自己的元素插入 <code>_elements</code>。</p>
<p>我们可以用 @synchronized结构更简要地实现这些：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@implementation ThreadSafeQueue</div><div class="line">&#123;</div><div class="line">    NSMutableArray *_elements;</div><div class="line">&#125;</div><div class="line">- (instancetype)init</div><div class="line">&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        _elements = [NSMutableArray array];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">- (void)increment</div><div class="line">&#123;</div><div class="line">    @synchronized (self) &#123;</div><div class="line">        [_elements addObject:element];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>在前面的例子中，<code>”synchronized block”</code>与 <code>[_lock lock]</code>和 <code>[_lock unlock]</code>效果相同。你可以把它当成是锁住 <code>self</code>，仿佛 self就是个 <code>NSLock</code>。<br><code>锁在左括号 {后面的任何代码运行之前被获取到，在右括号 }</code><br>后面的任何代码运行之前被释放掉。这爽就爽在妈妈再也不用担心我忘记调用 <code>unlock</code>了！<br>你可以给任何 <code>Objective-C</code> 对象上加个 <code>@synchronized</code>。那么我们也可以在上面的例子中用 <code>@synchronized(_elements)</code>来替代 <code>@synchronized(self)</code>，效果是相同的。</p>
<blockquote>
<p>转自<a href="http://www.cocoachina.com/ios/20151103/14007.html" target="_blank" rel="external">cocoa</a></p>
<p>@synchronized<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW3" target="_blank" rel="external">官方文档</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/13/jpush/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/13/jpush/" itemprop="url">JPush</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T14:37:43+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先是证书的的上传,按照官网的来(3.0.0)</p>
<h4 id="导入SDK-忽略"><a href="#导入SDK-忽略" class="headerlink" title="导入SDK(忽略)"></a>导入SDK(忽略)</h4><h4 id="添加头文件"><a href="#添加头文件" class="headerlink" title="添加头文件"></a>添加头文件</h4><blockquote>
<p>请将以下代码添加到 AppDelegate.m 引用头文件的位置。</p>
<p>引入JPush功能所需头文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &quot;JPUSHService.h&quot;</div><div class="line">// iOS10注册APNs所需头文件</div><div class="line">#ifdef NSFoundationVersionNumber_iOS_9_x_Max</div><div class="line">#import &lt;UserNotifications/UserNotifications.h&gt;</div><div class="line">#endif</div><div class="line">// 如果需要使用idfa功能所需要引入的头文件（可选）</div><div class="line">#import &lt;AdSupport/AdSupport.h&gt;</div></pre></td></tr></table></figure>
<h4 id="添加Delegate"><a href="#添加Delegate" class="headerlink" title="添加Delegate"></a>添加Delegate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//为AppDelegate添加Delegate。</div><div class="line">//参考代码：</div><div class="line">@interface AppDelegate ()&lt;JPUSHRegisterDelegate&gt;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#pragma mark - ===============JPUSH===============</div><div class="line">-(void)JPUSHWith:(NSDictionary *)launchOptions&#123;</div><div class="line">    if ([[UIDevice currentDevice].systemVersion floatValue] &gt;= 10.0) &#123;</div><div class="line">        JPUSHRegisterEntity * entity = [[JPUSHRegisterEntity alloc] init];</div><div class="line">        entity.types = UNAuthorizationOptionAlert|UNAuthorizationOptionBadge|UNAuthorizationOptionSound;</div><div class="line">        [JPUSHService registerForRemoteNotificationConfig:entity delegate:self];</div><div class="line">    &#125;</div><div class="line">    else if ([[UIDevice currentDevice].systemVersion floatValue] &gt;= 8.0) &#123;</div><div class="line">        //可以添加自定义categories</div><div class="line">        [JPUSHService registerForRemoteNotificationTypes:(UIUserNotificationTypeBadge |</div><div class="line">                                                          UIUserNotificationTypeSound |</div><div class="line">                                                          UIUserNotificationTypeAlert)</div><div class="line">                                              categories:nil];</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        //categories 必须为nil</div><div class="line">        [JPUSHService registerForRemoteNotificationTypes:(UIRemoteNotificationTypeBadge |</div><div class="line">                                                          UIRemoteNotificationTypeSound |</div><div class="line">                                                          UIRemoteNotificationTypeAlert) categories:nil];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    /*</div><div class="line">    //Required</div><div class="line">    //notice: 3.0.0及以后版本注册可以这样写，也可以继续用之前的注册方式</div><div class="line">    JPUSHRegisterEntity * entity = [[JPUSHRegisterEntity alloc] init];</div><div class="line">    entity.types = JPAuthorizationOptionAlert|JPAuthorizationOptionBadge|JPAuthorizationOptionSound;</div><div class="line">    if ([[UIDevice currentDevice].systemVersion floatValue] &gt;= 8.0) &#123;</div><div class="line">        // 可以添加自定义categories</div><div class="line">        // NSSet&lt;UNNotificationCategory *&gt; *categories for iOS10 or later</div><div class="line">        // NSSet&lt;UIUserNotificationCategory *&gt; *categories for iOS8 and iOS9</div><div class="line">    &#125;</div><div class="line">    [JPUSHService registerForRemoteNotificationConfig:entity delegate:self];</div><div class="line">    */</div><div class="line"></div><div class="line">    </div><div class="line">    </div><div class="line">    // Required</div><div class="line">    [JPUSHService setupWithOption:launchOptions appKey:@&quot;key&quot;</div><div class="line">                          channel:@&quot;appstore&quot;</div><div class="line">                 apsForProduction:0//0 (默认值)表示采用的是开发证书，1 表示采用生产证书发布应用</div><div class="line">            advertisingIdentifier:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h5 id="注册APNs成功并上报DeviceToken"><a href="#注册APNs成功并上报DeviceToken" class="headerlink" title="注册APNs成功并上报DeviceToken"></a>注册APNs成功并上报DeviceToken</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//请在AppDelegate.m实现该回调方法并添加回调方法中的代码</div><div class="line">- (void)application:(UIApplication *)application </div><div class="line">didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken &#123;</div><div class="line"></div><div class="line">  /// Required - 注册 DeviceToken</div><div class="line">  [JPUSHService registerDeviceToken:deviceToken];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="实现注册APNs失败接口（可选）"><a href="#实现注册APNs失败接口（可选）" class="headerlink" title="实现注册APNs失败接口（可选）"></a>实现注册APNs失败接口（可选）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error &#123;</div><div class="line">  //Optional</div><div class="line">  NSLog(@&quot;did Fail To Register For Remote Notifications With Error: %@&quot;, error);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="添加处理APNs通知回调方法"><a href="#添加处理APNs通知回调方法" class="headerlink" title="添加处理APNs通知回调方法"></a>添加处理APNs通知回调方法</h5><blockquote>
<p>请在AppDelegate.m实现该回调方法并添加回调方法中的代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">//#pragma mark- JPUSHRegisterDelegate</div><div class="line">// iOS 10 Support</div><div class="line">- (void)jpushNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(NSInteger))completionHandler &#123;</div><div class="line">  // Required</div><div class="line">  NSDictionary * userInfo = notification.request.content.userInfo;</div><div class="line">  if([notification.request.trigger isKindOfClass:[UNPushNotificationTrigger class]]) &#123;</div><div class="line">    [JPUSHService handleRemoteNotification:userInfo];</div><div class="line">  &#125;</div><div class="line">  completionHandler(UNNotificationPresentationOptionAlert); // 需要执行这个方法，选择是否提醒用户，有Badge、Sound、Alert三种类型可以选择设置</div><div class="line">  ////以最后为准 </div><div class="line">&#125;</div><div class="line"></div><div class="line">// iOS 10 Support</div><div class="line">- (void)jpushNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void (^)())completionHandler &#123;</div><div class="line">  // Required</div><div class="line">  NSDictionary * userInfo = response.notification.request.content.userInfo;</div><div class="line">  if([response.notification.request.trigger isKindOfClass:[UNPushNotificationTrigger class]]) &#123;</div><div class="line">    [JPUSHService handleRemoteNotification:userInfo];</div><div class="line">  &#125;</div><div class="line">  completionHandler();  // 系统要求执行这个方法</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler &#123;</div><div class="line"></div><div class="line">  // Required, iOS 7 Support</div><div class="line">  [JPUSHService handleRemoteNotification:userInfo];</div><div class="line">  completionHandler(UIBackgroundFetchResultNewData);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo &#123;</div><div class="line"></div><div class="line">  // Required,For systems with less than or equal to iOS6</div><div class="line">  [JPUSHService handleRemoteNotification:userInfo];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通知的点击</p>
<blockquote>
<p>前台</p>
</blockquote>
<p>10之前不用考虑, 之后能显示</p>
<p>点击执行</p>
<blockquote>
<p>后台</p>
</blockquote>
<p>一样</p>
<p>点击执行</p>
<blockquote>
<p>杀死</p>
</blockquote>
<p>肯定就是相当于点击图标  只不过有传的消息</p>
<p>点击执行</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/10/Operation Queues/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/10/Operation Queues/" itemprop="url">Operation Queues</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-10T13:12:26+08:00">
                2017-03-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/10/GCD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/10/GCD/" itemprop="url">GCD</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-10T13:12:26+08:00">
                2017-03-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自<a href="https://github.com/ShowJoy-com/showjoy-blog/issues/23?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">玩转GCD</a></p>
<h2 id="GCD介绍"><a href="#GCD介绍" class="headerlink" title="GCD介绍"></a>GCD介绍</h2><blockquote>
<p>Grand Central Dispatch (GCD)是Apple开发的一个多核编程的解决方法<br>基于C语言，提供了非常多强大的函数</p>
</blockquote>
<h5 id="同步-Synchronous"><a href="#同步-Synchronous" class="headerlink" title="同步 (Synchronous)"></a>同步 (Synchronous)</h5><blockquote>
<p>在当前线程中执行任务，不具备开启新线程的能力<br>提交的任务在执行完成后才会返回<br>同步函数: dispatch_sync()</p>
</blockquote>
<h5 id="异步-Asynchronous"><a href="#异步-Asynchronous" class="headerlink" title="异步 (Asynchronous)"></a>异步 (Asynchronous)</h5><blockquote>
<p>在新线程中执行任务，具备开启新线程的能力<br>提交的任务立刻返回，在后台队列中执行<br>异步函数: dispatch_async()</p>
</blockquote>
<h5 id="串行-Serial"><a href="#串行-Serial" class="headerlink" title="串行 (Serial)"></a>串行 (Serial)</h5><blockquote>
<p>一个任务执行完毕后，再执行下一个任务</p>
</blockquote>
<h5 id="并发-Concurrent"><a href="#并发-Concurrent" class="headerlink" title="并发 (Concurrent)"></a>并发 (Concurrent)</h5><blockquote>
<p>多个任务同时执行(自动开启多个线程),只有在异步函数下才有效</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1636852-859352b50fbe7a18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="描述"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1636852-8246ba74cdbcd9f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="函数"></p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意:"></a>注意:</h4><blockquote>
<p>1.所有的执行都放到队列中(queue)，队列的特点是FIFO（先提交的先执行）<br>2.必须在主线程访问 UIKit 的类<br>3.并发队列只在异步函数下才有效</p>
</blockquote>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程: %@&quot;, [NSThread currentThread]);</div><div class="line"> //获取主队列</div><div class="line"> dispatch_queue_t mainQueue = dispatch_get_main_queue();</div><div class="line"> </div><div class="line"> //获取全局并发队列</div><div class="line"> dispatch_queue_t otherQueue =   dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    </div><div class="line"> //同步函数(在当前线程中执行,不具备开启新线程的能力)</div><div class="line"> dispatch_sync(otherQueue, ^&#123;</div><div class="line">      NSLog(@&quot;同步 %@&quot;, [NSThread currentThread]);</div><div class="line"> &#125;);</div><div class="line">    </div><div class="line"> //异步函数(在另一条线程中执行,具备开启新线程的能力)</div><div class="line"> dispatch_async(otherQueue, ^&#123;</div><div class="line">      NSLog(@&quot;异步 %@&quot;, [NSThread currentThread]);</div><div class="line"> &#125;);</div><div class="line">    </div><div class="line"> //输出:   当前线程: &lt;NSThread: 0x7f81bac06670&gt;&#123;number = 1, name = main&#125;</div><div class="line"> //输出:   同步 &lt;NSThread: 0x7f81bac06670&gt;&#123;number = 1, name = main&#125;</div><div class="line"> //输出:   异步 &lt;NSThread: 0x7f81bae35be0&gt;&#123;number = 3, name = (null)&#125;</div></pre></td></tr></table></figure>
<h4 id="延时执行-dispatch-after"><a href="#延时执行-dispatch-after" class="headerlink" title="延时执行 dispatch_after()"></a>延时执行 dispatch_after()</h4><blockquote>
<p>dispatch_after()延迟一段时间把一项任务提交到队列中执行，返回之后就不能取消<br>常用来在在主队列上延迟执行一项任务</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line"></div><div class="line">    //GCD延时调用(主线程)(主队列)</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        NSLog(@&quot;GCD延时(主线程) %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //GCD延时调用(其他线程)(全局并发队列)</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        NSLog(@&quot;GCD延时(其他线程) %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    //输出:   当前线程 &lt;NSThread: 0x7f8cb9701990&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   GCD延时(主线程) &lt;NSThread: 0x7f8cb9701990&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   GCD延时(其他线程) &lt;NSThread: 0x7f8cb9513ee0&gt;&#123;number = 3, name = (null)&#125;</div></pre></td></tr></table></figure>
<h4 id="一次性执行-dispatch-once"><a href="#一次性执行-dispatch-once" class="headerlink" title="一次性执行 dispatch_once()"></a>一次性执行 dispatch_once()</h4><blockquote>
<p>整个程序运行中,只会执行一次 (默认线程是安全的)<br>dispatch_once() 以线程安全的方式执行且仅执行其代码块一次</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">for (NSInteger i = 0; i &lt; 10; i++) &#123;</div><div class="line">      </div><div class="line">        static dispatch_once_t onceToken;</div><div class="line">        dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">            NSLog(@&quot;GCD一次性执行(默认线程是安全的)&quot;);</div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line"></div><div class="line"> //输出:   GCD一次性执行(默认线程是安全的)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//使用GCD初始化单例</div><div class="line">+ (instancetype)sharedManager &#123; </div><div class="line">  </div><div class="line">    static PhotoManager *sharedPhotoManager = nil; </div><div class="line">    static dispatch_once_t onceToken; </div><div class="line">    dispatch_once(&amp;onceToken, ^&#123; </div><div class="line">        sharedPhotoManager = [[PhotoManager alloc] init]; </div><div class="line">    &#125;); </div><div class="line"></div><div class="line">    return sharedPhotoManager; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="提交-dispatch-apply"><a href="#提交-dispatch-apply" class="headerlink" title="提交 dispatch_apply()"></a>提交 dispatch_apply()</h4><blockquote>
<p>把一项任务提交到队列中多次执行，具体是并行执行还是串行执行由队列本身决定<br>dispatch_apply不会立刻返回，在执行完毕后才会返回，是同步的调用。</p>
</blockquote>
<h4 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h4><blockquote>
<p>任务1,任务2依次执行,所有任务都执行成功后回到主线程<br>(效率不高)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line">   </div><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        //全局并发队列</div><div class="line">        for (NSInteger i = 0; i &lt; 5; i++) &#123;</div><div class="line">            NSLog(@&quot;任务1 %@&quot;, [NSThread currentThread]);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        for (NSInteger i = 0; i &lt; 5; i++) &#123;</div><div class="line">            NSLog(@&quot;任务2 %@&quot;, [NSThread currentThread]);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            //主队列</div><div class="line">            NSLog(@&quot;主线程执行(刷新UI) %@&quot;, [NSThread currentThread]);</div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //输出:   当前线程 &lt;NSThread: 0x7fa78040b8b0&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7f9da1416a00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   主线程(刷新UI) &lt;NSThread: 0x7f9da1705940&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>
<h4 id="队列组"><a href="#队列组" class="headerlink" title="队列组"></a>队列组</h4><blockquote>
<p>任务1,任务2同时执行,所有任务都执行成功后回到主线程<br>(效率高)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line"></div><div class="line">//(1)创建一个队列组</div><div class="line">dispatch_group_t group= dispatch_group_create();</div><div class="line"></div><div class="line">//(2)开启任务1</div><div class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">   </div><div class="line">    for (NSInteger i = 0; i &lt; 5; i++) &#123;</div><div class="line">        NSLog(@&quot;任务1 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;);</div><div class="line"></div><div class="line">//(3)开启任务2</div><div class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">   </div><div class="line">    for (NSInteger i = 0; i &lt; 5; i++) &#123;</div><div class="line">        NSLog(@&quot;任务2 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;);</div><div class="line"></div><div class="line">//(4)所有任务执行完毕,回到主线程</div><div class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;主线程(刷新UI) %@&quot;, [NSThread currentThread]);</div><div class="line">    </div><div class="line">&#125;);</div><div class="line"></div><div class="line">//输出:   当前线程 &lt;NSThread: 0x7fd951704e70&gt;&#123;number = 1, name = main&#125;</div><div class="line">//输出:   任务1 &lt;NSThread: 0x7ff65a50b4d0&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">//输出:   任务1 &lt;NSThread: 0x7ff65a50b4d0&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">//输出:   任务1 &lt;NSThread: 0x7ff65a50b4d0&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">//输出:   任务2 &lt;NSThread: 0x7ff65a697770&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">//输出:   任务2 &lt;NSThread: 0x7ff65a697770&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">//输出:   任务1 &lt;NSThread: 0x7ff65a50b4d0&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">//输出:   任务2 &lt;NSThread: 0x7ff65a697770&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">//输出:   任务1 &lt;NSThread: 0x7ff65a50b4d0&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">//输出:   任务2 &lt;NSThread: 0x7ff65a697770&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">//输出:   任务2 &lt;NSThread: 0x7ff65a697770&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">//输出:   主线程(刷新UI) &lt;NSThread: 0x7ff65a406fb0&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>
<h3 id="串行与并发"><a href="#串行与并发" class="headerlink" title="串行与并发"></a>串行与并发</h3><p><img src="http://upload-images.jianshu.io/upload_images/1636852-fcd8af956632901c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="串行与并发"></p>
<h4 id="串行队列"><a href="#串行队列" class="headerlink" title="串行队列"></a>串行队列</h4><p><img src="http://upload-images.jianshu.io/upload_images/1636852-0cdb8b51311490ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="串行队列"></p>
<blockquote>
<p>一个任务执行完毕后，再执行下一个任务<br>主队列是GCD自带的一种特殊的串行队列,放在主队列中的任务,都会放到主线程中执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//(1)使用dispatch_queue_create函数创建串行队列</div><div class="line">    //参数1: 队列名称</div><div class="line"> //参数2: 队列属性 (一般用NULL)</div><div class="line">    dispatch_queue_t serialQueue = dispatch_queue_create(&quot;serialQueue&quot;, NULL);</div><div class="line">    </div><div class="line">    //(2)使用主队列（跟主线程相关联的队列）</div><div class="line">    dispatch_queue_t serialMainQueue = dispatch_get_main_queue();</div></pre></td></tr></table></figure>
<h4 id="并发队列"><a href="#并发队列" class="headerlink" title="并发队列"></a>并发队列</h4><p><img src="http://upload-images.jianshu.io/upload_images/1636852-da9ba8b03573b10d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="并发队列"></p>
<blockquote>
<p>多个任务并发执行（自动开启多个线程同时执行任务）<br>并发功能只有在异步（dispatch_async）函数下才有效!!!<br>GCD默认已经提供了全局的并发队列，供整个应用使用，不需要手动创建</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1636852-96ff1f2e335f4589.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="并发队列优先级"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//(1)使用dispatch_get_global_queue函数获得全局的并发队列</div><div class="line">    //参数1: 优先级</div><div class="line"> //参数2: 暂时无用参数 (传0)</div><div class="line">    dispatch_queue_t concurrentQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div></pre></td></tr></table></figure>
<h4 id="异步函数-并发队列"><a href="#异步函数-并发队列" class="headerlink" title="异步函数_并发队列"></a>异步函数_并发队列</h4><blockquote>
<p>(开启新线程,并发执行任务)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        NSLog(@&quot;任务1 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        NSLog(@&quot;任务2 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        NSLog(@&quot;任务3 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //输出:   当前线程 &lt;NSThread: 0x7fbe83c067c0&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7fb84160ed90&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务3 &lt;NSThread: 0x7fb841752940&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7fb8414167b0&gt;&#123;number = 5, name = (null)&#125;</div></pre></td></tr></table></figure>
<h4 id="异步函数-串行队列"><a href="#异步函数-串行队列" class="headerlink" title="异步函数_串行队列"></a>异步函数_串行队列</h4><blockquote>
<p>(开启新线程,串行执行任务)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line">    //创建串行队列</div><div class="line">    dispatch_queue_t serialQueue = dispatch_queue_create(&quot;serialQueue&quot;, NULL);</div><div class="line">    </div><div class="line">    dispatch_async(serialQueue, ^&#123;</div><div class="line">        NSLog(@&quot;任务1 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(serialQueue, ^&#123;</div><div class="line">        NSLog(@&quot;任务2 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(serialQueue, ^&#123;</div><div class="line">        NSLog(@&quot;任务3 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //输出:   当前线程 &lt;NSThread: 0x7fc192e05380&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7fc192c16670&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7fc192c16670&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">    //输出:   任务3 &lt;NSThread: 0x7fc192c16670&gt;&#123;number = 3, name = (null)&#125;</div></pre></td></tr></table></figure>
<h4 id="同步函数-并发队列"><a href="#同步函数-并发队列" class="headerlink" title="同步函数_并发队列"></a>同步函数_并发队列</h4><blockquote>
<p>(不会开启新线程,并发执行任务失效!)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line">    dispatch_sync(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        NSLog(@&quot;任务1 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_sync(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        NSLog(@&quot;任务2 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_sync(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        NSLog(@&quot;任务3 %@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    //输出:   当前线程 &lt;NSThread: 0x7fa0dbf02e20&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   任务1 &lt;NSThread: 0x7fa0dbf02e20&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   任务2 &lt;NSThread: 0x7fa0dbf02e20&gt;&#123;number = 1, name = main&#125;</div><div class="line">    //输出:   任务3 &lt;NSThread: 0x7fa0dbf02e20&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>
<h4 id="同步函数-串行队列"><a href="#同步函数-串行队列" class="headerlink" title="同步函数_串行队列"></a>同步函数_串行队列</h4><blockquote>
<p>(不会开启新线程,串行执行任务)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;当前线程 %@&quot;, [NSThread currentThread]);</div><div class="line"> //创建串行队列</div><div class="line"> dispatch_queue_t serialQueue = dispatch_queue_create(&quot;serialQueue&quot;, NULL);</div><div class="line"> dispatch_sync(serialQueue, ^&#123;</div><div class="line">     NSLog(@&quot;任务1 %@&quot;, [NSThread currentThread]);</div><div class="line"> &#125;);</div><div class="line"></div><div class="line"> dispatch_sync(serialQueue, ^&#123;</div><div class="line">      NSLog(@&quot;任务2 %@&quot;, [NSThread currentThread]);</div><div class="line"> &#125;);</div><div class="line"></div><div class="line"> dispatch_sync(serialQueue, ^&#123;</div><div class="line">     NSLog(@&quot;任务3 %@&quot;, [NSThread currentThread]);</div><div class="line"> &#125;);</div><div class="line"></div><div class="line"> //输出:   当前线程 &lt;NSThread: 0x7f8c0b407f00&gt;&#123;number = 1, name = main&#125;</div><div class="line"> //输出:   任务1 &lt;NSThread: 0x7f8c0b407f00&gt;&#123;number = 1, name = main&#125;</div><div class="line"> //输出:   任务2 &lt;NSThread: 0x7f8c0b407f00&gt;&#123;number = 1, name = main&#125;</div><div class="line"> //输出:   任务3 &lt;NSThread: 0x7f8c0b407f00&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/15/iOS-友盟统计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/15/iOS-友盟统计/" itemprop="url">友盟统计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-15T15:30:55+08:00">
                2017-02-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这次记录下<br>1 获取appkey (统计和分享是一个)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1636852-c3f7f91968d763c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Appkey.png"></p>
<p>2 使用 Cocoapods 安装 SDK<br><img src="http://upload-images.jianshu.io/upload_images/1636852-bf722817169714c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pod.png"></p>
<p>3 基本功能集成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#import &quot;UMMobClick/MobClick.h&quot;</div><div class="line"></div><div class="line">...</div><div class="line">- (BOOL])application:(UIApplication] *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</div><div class="line">&#123;</div><div class="line">    UMConfigInstance.appKey = @&quot;xxxxxxxxxxxxxx...&quot;;</div><div class="line">    UMConfigInstance.ChannelId = @&quot;App Store&quot;;</div><div class="line">    UMConfigInstance.eSType = E_UM_GAME; //仅适用于游戏场景，应用统计不用设置</div><div class="line">    …</div><div class="line">    NSString *version = [[[NSBundle mainBundle] infoDictionary] objectForKey:@&quot;CFBundleShortVersionString&quot;];</div><div class="line">    [MobClick setAppVersion:version];</div><div class="line">    [MobClick startWithConfigure:UMConfigInstance];//配置以上参数后调用此方法初始化SDK！</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4 基本功能集成</p>
<blockquote>
<p>记住在生命周期协商这两个方法<br>[MobClick beginLogPageView:self.title];</p>
<p>[MobClick endLogPageView:self.title];</p>
</blockquote>
<p>当然对于后来的项目可以使用RunTime进行解决</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//写一个UIViewController的分类</div><div class="line">+(void)load&#123;</div><div class="line">    Method viewAppear = class_getInstanceMethod([UIViewController class], @selector(viewWillAppear:));</div><div class="line">    Method SW_viewAppear = class_getInstanceMethod([UIViewController class], @selector(SW_viewWillAppear:));</div><div class="line">    method_exchangeImplementations(viewAppear, SW_viewAppear);</div><div class="line">    Method viewdisAppear = class_getInstanceMethod([UIViewController class], @selector(viewWillDisappear:));</div><div class="line">    Method SW_viewdisAppear = class_getInstanceMethod([UIViewController class], @selector(SW_viewWillDisappear:));</div><div class="line">    method_exchangeImplementations(viewdisAppear, SW_viewdisAppear);</div><div class="line">&#125;</div><div class="line">-(void)SW_viewWillAppear:(BOOL)animation&#123;</div><div class="line">    [self SW_viewWillAppear:animation];</div><div class="line">    if (self.title) &#123;</div><div class="line">        [MobClick beginLogPageView:self.title];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)SW_viewWillDisappear:(BOOL)animation&#123;</div><div class="line">    [self SW_viewWillDisappear:animation];</div><div class="line">    if (self.title) &#123;</div><div class="line">        [MobClick endLogPageView:self.title];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/22/iOS-Xcode8改动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/22/iOS-Xcode8改动/" itemprop="url">iOS-Xcode8改动</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-22T10:03:33+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>撤销打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">OS_ACTIVITY_MODE=disable</div></pre></td></tr></table></figure>
</li>
<li><p>权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</div><div class="line"> &lt;dict&gt;</div><div class="line">  &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</div><div class="line">  &lt;true/&gt;</div><div class="line"> &lt;/dict&gt;</div><div class="line"> &lt;key&gt;NSContactsUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问通讯录&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSAppleMusicUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问媒体资料库&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSBluetoothPeripheralUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问蓝牙&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSCalendarsUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问日历&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSCameraUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问相机&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSHealthShareUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问健康分享&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSHealthUpdateUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问健康更新 &lt;/string&gt;</div><div class="line"> &lt;key&gt;NSLocationAlwaysUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能始终访问位置&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSLocationUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问位置&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSLocationWhenInUseUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能在使用期间访问位置&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSMicrophoneUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问麦克风&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSMotionUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问运动与健身&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问相册&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSRemindersUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问提醒事项&lt;/string&gt;</div><div class="line"> &lt;key&gt;NSContactsUsageDescription&lt;/key&gt;</div><div class="line"> &lt;string&gt;App需要您的同意,才能访问通讯录&lt;/string&gt;</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/22/所有的布局方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/22/所有的布局方法/" itemprop="url">所有的布局方法总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-22T10:03:33+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (void)setNeedsDisplay;</div><div class="line">- (void)drawRect:(CGRect)rect</div><div class="line">- </div><div class="line">[self setAutoresizesSubviews:YES];</div><div class="line"></div><div class="line">- (void)layoutSubviews; </div><div class="line">- (void)layoutIfNeeded;</div><div class="line">- (void)setNeedsLayout;</div><div class="line"></div><div class="line">- (CGSize)sizeThatFits:(CGSize)size</div><div class="line">- (void)sizeToFit;</div></pre></td></tr></table></figure>
<h3 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h3><p>&gt;</p>
<ul>
<li>-drawRect:(CGRect)rect方法：重写此方法，执行重绘任务</li>
<li>-setNeedsDisplay方法：标记为需要重绘，异步调用drawRect</li>
<li>-setNeedsDisplayInRect:(CGRect)invalidRect方法：标记为需要局部重绘</li>
</ul>
<h4 id="setNeedsDisplay"><a href="#setNeedsDisplay" class="headerlink" title="setNeedsDisplay"></a>setNeedsDisplay</h4><p><a href="">link</a></p>
<blockquote>
<p>标记为需要重绘，异步调用drawRect</p>
<p>drawRect是对receiver的重绘，能获得context</p>
<p>setNeedDisplay在receiver标上一个需要被重新绘图的标记，在下一个draw周期自动重绘，iphone device的刷新频率是60hz，也就是1/60秒后重绘 </p>
</blockquote>
<h4 id="drawRect"><a href="#drawRect" class="headerlink" title="drawRect"></a>drawRect</h4><p><a href="http://www.jcodecraeer.com/IOS/2015/0204/2414.html" target="_blank" rel="external">link</a></p>
<blockquote>
<p>重绘机制drawRect</p>
<p>iOS的绘图操作是在UIView类的drawRect方法中完成的，所以如果我们要想在一个UIView中绘图，需要写一个扩展UIView 的类，并重写drawRect方法，在这里进行绘图操作，程序会自动调用此方法进行绘图。<br>下面先说明一下绘图，比如，你想绘制一个方块，你需要写一个类来扩展UIView并在drawRect方法中填入如下代码：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (void)drawRect:(CGRect)rect &#123;  </div><div class="line">   // Drawing code.  </div><div class="line">   //获得处理的上下文    </div><div class="line">   CGContextRef context = UIGraphicsGetCurrentContext();    </div><div class="line">   //设置线条样式    </div><div class="line">   CGContextSetLineCap(context, kCGLineCapSquare);     </div><div class="line">   //设置线条粗细宽度    </div><div class="line">   CGContextSetLineWidth(context, 1.0);     </div><div class="line">   //设置颜色    </div><div class="line">   CGContextSetRGBStrokeColor(context, 1.0, 0.0, 0.0, 1.0);     </div><div class="line">   //开始一个起始路径    </div><div class="line">   CGContextBeginPath(context);     </div><div class="line">   //起始点设置为(0,0):注意这是上下文对应区域中的相对坐标，    </div><div class="line">   CGContextMoveToPoint(context, 0, 0);     </div><div class="line">   //设置下一个坐标点    </div><div class="line">   CGContextAddLineToPoint(context, 100, 100);     </div><div class="line">   //设置下一个坐标点    </div><div class="line">   CGContextAddLineToPoint(context, 0, 150);    </div><div class="line">   //设置下一个坐标点    </div><div class="line">   CGContextAddLineToPoint(context, 50, 180);    </div><div class="line">   //连接上面定义的坐标点    </div><div class="line">   CGContextStrokePath(context);</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/Users/mac/Library/Mobile Documents/com~apple~CloudDocs/Hexo/source/_posts/Pic/007.png" alt=""></p>
<blockquote>
<p>再说明一下重绘，重绘操作仍然在drawRect方法中完成，但是苹果不建议直接调用drawRect方法，当然如果你强直直接调用此方法，当然是没有效果的。苹果要求我们调用UIView类中的setNeedsDisplay方法，则程序会自动调用drawRect方法进行重绘。==（调用setNeedsDisplay会自动调用drawRect）==</p>
<p>在UIView中,重写drawRect: (CGRect) aRect方法,可以自己定义想要画的图案.且此方法一般情况下只会画一次.也就是说这个drawRect方法一般情况下只会被掉用一次. 当==某些情况下想要手动重画这个View,只需要掉用[self setNeedsDisplay]方法==即可.</p>
</blockquote>
<ul>
<li></li>
</ul>
<blockquote>
<p>==drawRect调是在Controller-&gt;loadView, Controller-&gt;viewDidLoad 两方法之后掉用的==.所以不用担心在控制器中,这些View的drawRect就开始画了.这样可以在控制器中设置一些值给View(如果这些View draw的时候需要用到某些变量值).</p>
</blockquote>
<p>&gt;</p>
<ol>
<li>如果在UIView初始化时没有设置rect大小，将直接导致drawRect不被自动调用。</li>
<li>该方法在调用sizeThatFits后被调用，所以可以先调用sizeToFit计算出size。然后系统自动调用drawRect:方法。</li>
<li>通过设置contentMode属性值为UIViewContentModeRedraw。那么将在每次设置或更改frame的时候自动调用drawRect:。</li>
<li>直接调用setNeedsDisplay，或者setNeedsDisplayInRect:触发drawRect:，但是有个前提条件是rect不能为0.</li>
</ol>
<ul>
<li>以上1,2推荐；而3,4不提倡</li>
</ul>
<p>&gt;</p>
<ol>
<li>若使用UIView绘图，只能在drawRect：方法中获取相应的contextRef并绘图。如果在其他方法中获取将获取到一个invalidate的ref并且不能用于画图。drawRect：方法不能手动显示调用，必须通过调用setNeedsDisplay 或者 setNeedsDisplayInRect ，让系统自动调该方法。</li>
<li>若使用calayer绘图，只能在drawInContext: 中（类似于drawRect）绘制，或者在delegate中的相应方法绘制。同样也是调用setNeedDisplay等间接调用以上方法。</li>
<li>若要实时画图，不能使用gestureRecognizer，只能使用touchbegan等方法来掉用setNeedsDisplay实时刷新屏幕</li>
</ol>
<hr>
<h4 id="self-setAutoresizesSubviews-YES"><a href="#self-setAutoresizesSubviews-YES" class="headerlink" title="[self setAutoresizesSubviews:YES];"></a>[self setAutoresizesSubviews:YES];</h4><blockquote>
<p>autoresizing是UIView的属性，一直存在，使用也比较简单，但是没有autolayout那样强大。如果你的界面比较简单，要求的细节没有那么高，那么你完全可以使用autoresizing去进行自动布局</p>
<p>Autolayout（Autolayout是IOS6以后新增）</p>
</blockquote>
<p><a href="http://www.2cto.com/kf/201412/361676.html" target="_blank" rel="external">link</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">UIViewAutoresizing是一个枚举类型，默认是UIViewAutoresizingNone，也就是不做任何处理。</div><div class="line"> </div><div class="line">typedef NS_OPTIONS(NSUInteger, UIViewAutoresizing) &#123;</div><div class="line">    UIViewAutoresizingNone                 = 0,</div><div class="line">    UIViewAutoresizingFlexibleLeftMargin   = 1 &lt;&lt; 0,</div><div class="line">    UIViewAutoresizingFlexibleWidth        = 1 &lt;&lt; 1,</div><div class="line">    UIViewAutoresizingFlexibleRightMargin  = 1 &lt;&lt; 2,</div><div class="line">    UIViewAutoresizingFlexibleTopMargin    = 1 &lt;&lt; 3,</div><div class="line">    UIViewAutoresizingFlexibleHeight       = 1 &lt;&lt; 4,</div><div class="line">    UIViewAutoresizingFlexibleBottomMargin = 1 &lt;&lt; 5</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>各属性解释：</p>
</blockquote>
<table>
<thead>
<tr>
<th>header 1</th>
<th>header 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>UIViewAutoresizingNone</td>
<td>不会随父视图的改变而改变</td>
</tr>
<tr>
<td>UIViewAutoresizingFlexibleLeftMargin</td>
<td>自动调整view与父视图左边距，以保证右边距不变</td>
</tr>
<tr>
<td>UIViewAutoresizingFlexibleWidth</td>
<td>自动调整view的宽度，保证左边距和右边距不变</td>
</tr>
<tr>
<td>UIViewAutoresizingFlexibleRightMargin</td>
<td>自动调整view与父视图右边距，以保证左边距不变</td>
</tr>
<tr>
<td>UIViewAutoresizingFlexibleTopMargin</td>
<td>自动调整view与父视图上边距，以保证下边距不变</td>
</tr>
<tr>
<td>UIViewAutoresizingFlexibleHeight</td>
<td>自动调整view的高度，以保证上边距和下边距不变</td>
</tr>
<tr>
<td>UIViewAutoresizingFlexibleBottomMargin</td>
<td>自动调整view与父视图的下边距，以保证上边距不变</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在这里说明一下，如果是经常使用Storyboard/Xib设置autoresizing，那么转变使用代码设置autoresizing的话，容易出现理解错误问题。比如说UIViewAutoresizingFlexibleTopMargin，也许会被误认为是顶部距离不变，其实是底部距离不变。这个解决办法也很简单，只需要把使用代码和使用Storyboard设置autoresizing，它们是相反的，只需要这样去记就可以了。</p>
<p>如果视图的autoresizesSubviews属性被设置为 NO，则该视图的直接子视图的所有自动尺寸调整行为将被忽略。</p>
<p>类似地，如果一个子视图的自动尺寸调整掩码被设置为 UIViewAutoresizingNone，则该子视图的尺寸将不会被调整，因而其直接子视图的尺寸也不会被调整。</p>
<p>请注意：为了使自动尺寸调整的行为正确，视图的transform属性必须设置为恒等变换；其它变换下的尺寸自动调整行为是未定义的。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">可以在设置好frame后再添加</div><div class="line"></div><div class="line">[View setAutoresizingMask:UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleBottomMargin | UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleLeftMargin];</div></pre></td></tr></table></figure>
<h3 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h3><p>&gt;</p>
<ul>
<li>-(void)layoutSubviews; 这个方法，默认没有做任何事情，需要子类进行重写</li>
<li>-(void)layoutIfNeeded; 标记为需要重新布局，异步调用layoutIfNeeded刷新布局，不立即刷新，但layoutSubviews一定会被调用</li>
<li>-(void)setNeedsLayout; 如果，有需要刷新的标记，立即调用layoutSubviews进行布局（如果没有标记，不会调用layoutSubviews）</li>
</ul>
<p>*</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">layoutSubviews对subviews重新布局</div><div class="line"></div><div class="line">layoutSubviews方法调用先于drawRect</div><div class="line"></div><div class="line">setNeedsLayout在receiver标上一个需要被重新布局的标记，在系统runloop的下一个周期自动调用layoutSubviews</div><div class="line"></div><div class="line">layoutIfNeeded方法如其名，UIKit会判断该receiver是否需要layout.根据Apple官方文档,layoutIfNeeded方法应该是这样的</div><div class="line"></div><div class="line">layoutIfNeeded遍历的不是superview链，应该是subviews链</div></pre></td></tr></table></figure>
<blockquote>
<p>layoutSubviews在以下情况下会被调用：</p>
</blockquote>
<ol>
<li><p>init初始化不会触发layoutSubviews,但是是用initWithFrame 进行初始化时，当rect的值不为CGRectZero时,也会触发</p>
</li>
<li><p>addSubview会触发layoutSubviews</p>
</li>
<li><p>设置view的Frame会触发layoutSubviews，当然前提是frame的值设置前后发生了变化</p>
</li>
<li><p>滚动一个UIScrollView会触发layoutSubviews</p>
</li>
<li><p>旋转Screen会触发父UIView上的layoutSubviews事件</p>
</li>
<li><p>改变一个UIView大小的时候也会触发父UIView上的layoutSubviews事件</p>
</li>
</ol>
<blockquote>
<p>在苹果的官方文档中强调:</p>
</blockquote>
<pre><code>You should override this method only if the autoresizing behaviors of the subviews do not offer the behavior you want.
</code></pre><blockquote>
<p>layoutSubviews, 当我们在某个类的内部调整子视图位置时，需要调用。</p>
<p>反过来的意思就是说：如果你想要在外部设置subviews的位置，就不要重写。</p>
</blockquote>
<h3 id="sizeToFit"><a href="#sizeToFit" class="headerlink" title="sizeToFit"></a>sizeToFit</h3><p>&gt;</p>
<ul>
<li>-(CGSize)sizeThatFits:(CGSize)size</li>
<li>-(void)sizeToFit;</li>
</ul>
<p>*</p>
<blockquote>
<p>sizeToFit会自动调用sizeThatFits方法；</p>
<p>sizeToFit不应该在子类中被重写，应该重写sizeThatFits</p>
<p>sizeThatFits传入的参数是receiver当前的size，返回一个适合的size</p>
<p>sizeToFit可以被手动直接调用</p>
<p>sizeToFit和sizeThatFits方法都没有递归，对subviews也不负责，只负责自己</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/iOS-项目中的图片上传/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SongWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/17/iOS-项目中的图片上传/" itemprop="url">iOS-项目中的图片上传</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-17T10:44:27+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>不积跬步,无以至千里<br>不积小流,无以成江海</p>
</blockquote>
<p>项目中的图片上传肯定是必不可少的内容,以下先将项目中的copy下来,而且仅仅是作为头像单个文件的上传,以后有时间在详细整理下</p>
<h5 id="1-点击头像按钮"><a href="#1-点击头像按钮" class="headerlink" title="1. 点击头像按钮"></a>1. 点击头像按钮</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">所在的视图控制器需要遵从下&lt;UIImagePickerControllerDelegate&gt;代理</div><div class="line">- (void)changeImage:(UIButton *)sender &#123;</div><div class="line"></div><div class="line">//创建常见的下滑提示栏, 注意iOS8 才有这个控件</div><div class="line">    UIAlertController  *alert = [UIAlertController alertControllerWithTitle:nil message:nil preferredStyle:(UIAlertControllerStyleActionSheet)];</div><div class="line">    UIAlertAction  *cancelAction = [UIAlertAction actionWithTitle:@&quot;取消&quot; style:(UIAlertActionStyleCancel) handler:^(UIAlertAction * _Nonnull action) &#123; &#125;];</div><div class="line">    UIAlertAction  *fromPhotoAction = [UIAlertAction actionWithTitle:@&quot;从相册选择&quot; style:(UIAlertActionStyleDefault) handler:^(UIAlertAction * _Nonnull action)  &#123;</div><div class="line">        UIImagePickerController *imagePicker = [[UIImagePickerController alloc] init];</div><div class="line">        imagePicker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;</div><div class="line">        imagePicker.modalTransitionStyle = UIModalTransitionStyleCoverVertical;</div><div class="line">        imagePicker.allowsEditing = YES;</div><div class="line">        imagePicker.delegate = self;</div><div class="line">        [self presentViewController:imagePicker animated:YES completion:nil];</div><div class="line">    &#125;];</div><div class="line">    UIAlertAction  *fromCameraAction = [UIAlertAction actionWithTitle:@&quot;拍照&quot; style:(UIAlertActionStyleDefault) handler:^(UIAlertAction * _Nonnull action)  &#123;</div><div class="line">        UIImagePickerController *imagePicker = [[UIImagePickerController alloc] init];</div><div class="line">        imagePicker.delegate = self;</div><div class="line">        imagePicker.allowsEditing = YES;</div><div class="line">        imagePicker.modalTransitionStyle = UIModalTransitionStyleCoverVertical;</div><div class="line">        imagePicker.sourceType = UIImagePickerControllerSourceTypeCamera;</div><div class="line">        [self presentViewController:imagePicker animated:YES completion:nil];</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [alert addAction:cancelAction];</div><div class="line">    [alert addAction:fromCameraAction];</div><div class="line">    [alert addAction:fromPhotoAction];</div><div class="line">    [self presentViewController:alert animated:YES completion:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="2-选中图片的处理"><a href="#2-选中图片的处理" class="headerlink" title="2. 选中图片的处理"></a>2. 选中图片的处理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">代理方法获取图片</div><div class="line">- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info</div><div class="line">&#123;</div><div class="line">    [picker dismissViewControllerAnimated:YES completion:nil];</div><div class="line">    //可裁剪</div><div class="line">    UIImage *image = [info objectForKey:UIImagePickerControllerEditedImage];</div><div class="line">    //原图</div><div class="line">    //UIImage *image = [info objectForKey:UIImagePickerControllerOriginalImage];</div><div class="line">    [self performSelector:@selector(saveImage:) withObject:image afterDelay:0.5];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="3-保存图片"><a href="#3-保存图片" class="headerlink" title="3. 保存图片"></a>3. 保存图片</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">-(void)saveImage:(UIImage *)image&#123;</div><div class="line">//传递的参数</div><div class="line">    NSMutableDictionary *parameters = [NSMutableDictionary dictionary];</div><div class="line">    [parameters setObject:@&quot;&quot;forKey:@&quot;userId&quot;];</div><div class="line">//图片压缩处理</div><div class="line">    NSData *imageData = UIImageJPEGRepresentation(image, 0.5);</div><div class="line">//利用AFNetworking上传data</div><div class="line">    AFHTTPSessionManager * mgr = [AFHTTPSessionManager manager];</div><div class="line">    mgr.responseSerializer.acceptableContentTypes = [NSSet setWithObject:@&quot;text/html&quot;];</div><div class="line">     [mgr POST:[NSString stringWithFormat:@&quot;%@%@&quot;,BaseAPI,@&quot;/app/uploadPhoto&quot;] parameters:parameters constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt;  _Nonnull formData) &#123; </div><div class="line">//上传时使用当前的系统事件作为文件名</div><div class="line">        NSDateFormatter *formatter = [[NSDateFormatter alloc] init];</div><div class="line">        formatter.dateFormat = @&quot;yyyyMMddHHmmss&quot;;</div><div class="line">        formatter.timeZone = [NSTimeZone timeZoneWithAbbreviation:@&quot;GMT+0800&quot;];</div><div class="line">        NSString *str = [formatter stringFromDate:[NSDate date]];</div><div class="line">        NSString *fileName = [NSString stringWithFormat:@&quot;%@.jpg&quot;, str];</div><div class="line">//上传图片</div><div class="line">        [formData appendPartWithFileData:imageData name:@&quot;imgFile&quot; fileName:fileName  mimeType:@&quot;image/jpeg&quot;];</div><div class="line">            </div><div class="line">        &#125; progress:nil success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</div><div class="line">//返回结果</div><div class="line">        NSLOG(@&quot;Success &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;%@&quot;, responseObject);</div><div class="line">        &#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line">      &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>图片上传的基本功能算是有了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="SongWei" />
          <p class="site-author-name" itemprop="name">SongWei</p>
           
              <p class="site-description motion-element" itemprop="description">先拆轮子,在造轮子!</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.baidu.com" target="_blank" title="百度">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      百度
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SongWei</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.2</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
